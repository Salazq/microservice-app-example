trigger:
- master

pool:
  vmImage: ubuntu-latest

variables:
  REDIS_HOST: 127.0.0.1
  REDIS_PORT: 6379
  REDIS_CHANNEL: log_channel

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.8'  # Versión más antigua disponible en el agente
    architecture: 'x64'
  displayName: 'Use Python 3.8'

- script: |
    python -m pip install --upgrade pip setuptools wheel
    pip install -r requirements.txt
  displayName: 'Install dependencies'

# Paso opcional para Redis (si necesitas local)
- script: |
    sudo apt-get update
    sudo apt-get install -y redis-server
    sudo service redis-server start
    redis-cli ping
  displayName: 'Install and start Redis'
  condition: and(succeeded(), eq(variables['REDIS_HOST'], '127.0.0.1'))

- script: |
    python main.py
  displayName: 'Run application'
  env:
    REDIS_HOST: $(REDIS_HOST)
    REDIS_PORT: $(REDIS_PORT)
    REDIS_CHANNEL: $(REDIS_CHANNEL)